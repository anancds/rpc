



### github社区的生态和影响力

| 组件     | star/fork  | 版本节奏    | 活跃度(commit/month) | 最新版本                                                     |
| -------- | ---------- | ----------- | -------------------- | ------------------------------------------------------------ |
| zeromq   | 6.4k/1.8k  | 3个月到半年 | 6人提交22次          | [libzmq 4.3.3](https://github.com/zeromq/libzmq/releases/tag/v4.3.3) 发布14天 |
| gRPC     | 27.6k/7k   | 半个月      | 28人提交182次        | [Release v1.32.0](https://github.com/grpc/grpc/releases/tag/v1.32.0) 发布12天 |
| bRPC     | 10.6k/2.6k | 半年        | 6人提交12次          | [brpc 0.9.7](https://github.com/apache/incubator-brpc/releases/tag/0.9.7) 2020.3.6 |
| libevent | 6.6k/2.5k  | 1个月到1年  | 5人提交13次          | [release-2.1.12-stable](https://github.com/libevent/libevent/releases/tag/release-2.1.12-stable) 2020.7.5 |

### 通信模型比较：

##### zeromq支持请求回应、发布订阅、管道模型。

请求回应：请求回应模型。由请求端发起请求，并等待回应端回应请求。从请求端来看，一定是一对对收发配对的；反之，在回应端一定是发收对。请求端和回应端都可以是 1:N 的模型。通常把 1 认为是 server ，N 认为是 Client 。

发布订阅：发布端是单向只发送数据的，且不关心是否把全部的信息都发送给订阅端。如果发布端开始发布信息的时候，订阅端尚未连接上来，这些信息直接丢弃。不过一旦订阅端连接上来，中间会保证没有信息丢失。同样，订阅端则只负责接收，而不能反馈。如果发布端和订阅端需要交互（比如要确认订阅者是否已经连接上），则使用额外的 socket 采用请求回应模型满足这个需求。

管道模型：管道是单向的，从 PUSH 端单向的向 PULL 端单向的推送数据流



##### gRPC支持单项rpc、服务端流式rpc、客户端流失rpc、双向流式rpc，并且支持同步和异步。

单项rpc：客户端发出单个请求，获得单个响应。

服务端流式rpc：服务端流式 RPC 除了在得到客户端请求信息后发送回一个应答流之外，与我们的简单例子一样。在发送完所有应答后，服务端的状态详情(状态码和可选的状态信息)和可选的跟踪元数据被发送回客户端，以此来完成服务端的工作。客户端在接收到所有服务端的应答后也完成了工作。

客户端流式rpc：客户端流式 RPC 也基本与我们的简单例子一样，区别在于客户端通过发送一个请求流给服务端，取代了原先发送的单个请求。服务端通常（但并不必须）会在接收到客户端所有的请求后发送回一个应答，其中附带有它的状态详情和可选的跟踪数据。

双向流式rpc：双向流式 RPC ，调用由客户端调用方法来初始化，而服务端则接收到客户端的元数据，方法名和截止时间。服务端可以选择发送回它的初始元数据或等待客户端发送请求。 下一步怎样发展取决于应用，因为客户端和服务端能在任意顺序上读写 - 这些流的操作是完全独立的。例如服务端可以一直等直到它接收到所有客户端的消息才写应答，或者服务端和客户端可以像"乒乓球"一样：服务端后得到一个请求就回送一个应答，接着客户端根据应答来发送另一个请求，以此类推。

### 性能测试

机器配置：

Intel(R) Core(TM) i7-8565U CPU @ 1.80GHz，4核，OS linux 5.4.0-47-generic，

zeromq的rep模式，100byte，持续30s，测试客户端并发1、5、10、100的影响

| QPS    | average latency(ms) | client | 网卡平均吞吐(MBit/s) |
| ------ | ------------------- | ------ | -------------------- |
| 43513  | 0.025               | 1      | 64                   |
| 127837 | 0.042               | 5      | 181                  |
| 128249 | 0.086               | 10     | 241                  |
| 126909 | 0.86                | 100    | 151                  |

zeromq的rep模式，1客户端，持续30s，测试数据量10B、1kB、1M、10M的影响

| QPS   | average latency(ms) | request data size | 网卡平均流量(MBit/s) |
| ----- | ------------------- | ----------------- | -------------------- |
| 44060 | 0.024               | 10B               | 38                   |
| 43400 | 0.025               | 1kB               | 344                  |
| 4038  | 0.27                | 1MB               | 18045                |
| 295   | 3.71                | 10MB              | 29022                |

grpc，100Byte，持续30s，测试客户端的并发1、5、10、100的影响

| QPS   | average latency(ms) | client | 网卡平均流量(MBit/s) |
| ----- | ------------------- | ------ | -------------------- |
| 8639  | 0.12                | 1      | 28                   |
| 16194 | 0.33                | 5      | 58                   |
| 15697 | 0.70                | 10     | 62                   |
| 21044 | 5.1                 | 100    | 64                   |

grpc，1客户端，持续30s，测试数据量10B、1kB、1M、10M的影响

| throughPut | average latency(ms) | request data size | 网卡平均流量(MBit/s) |
| ---------- | ------------------- | ----------------- | -------------------- |
| 8806       | 0.12                | 10B               | 19                   |
| 8344       | 0.13                | 1kB               | 135                  |
| 437        | 2.51                | 1MB               | 5404                 |
| 129        | 8.5                 | 10MB              | 9495                 |

brpc，100Byte，持续30s，测试客户端的并发1、5、10、100的影响

| QPS    | average latency(ms) | client | 网卡平均流量(MBit/s) |
| ------ | ------------------- | ------ | -------------------- |
| 26883  | 0.031               | 1      | 72                   |
| 56187  | 0.096               | 5      | 102                  |
| 84712  | 0.12                | 10     | 223                  |
| 153381 | 0.71099             | 100    | 334                  |

brpc，1客户端，持续30s，测试数据量10B、1kB、10KB、100KB的影响

| throughPut | average latency(ms) | request data size | 网卡平均流量(MBit/s) |
| ---------- | ------------------- | ----------------- | -------------------- |
| 25171      | 0.042               | 10B               | 41                   |
| 25308      | 0.0423              | 1kB               | 383                  |
| 19983      | 0.0532              | 10kB              | 2930                 |
| 8204       | 0.17                | 100KB             | 8404                 |